== GEO 拓展数据类型

* 适用于 LBS (Location-Based Service, 位置信息服务)的应用

* LBS 应用访问的数据是人和物关联的一组经纬度信息，而且经常要能查询相邻的经纬度范围，GEO就比较适合

=== GEO 的底层结构

* 因为 LBS 类型的需求一般都需要进行范围查询，所以 *hash* 是不行的

* 使用 *zset* 可以满足需求， GEO的底层结构也是基于 *zset* 的

* 经纬度是两个数组，所以 *zset* 的 score 是通过业界通用的 GeoHash 编码方法

=== GeoHash 编码方法

* 基本原理是 *二分区间, 区间编码*

* 比如说一个经度的范围是 [-180, 180],那么就会编码为一个N位的值(取决于需求，N越大，分的越细)

** 先看某个经度是属于 [-180, 0] 还是 [180, 0], 如果是左边就编码为0, 右边就编码为1

** 之后在看某个经度是属于 [0, 90] 还是 [90, 180], 如果是左边就编码为0，右边就编码为1

** 依此类推，最后得到一串二进制编码

* 维度也是采用经度类似的编码方法

* 最后经度和维度合成一个码值，经度的码放奇数位，维度的码放偶数位, 就完成了编码

* 比如 经纬度（116.37，39.86）, 各自编码后是 11010和10111, 最终编码是1110011101

=== 如何操作 GEO 类型

* GEOADD: 用于把一组经纬度信息和相对应的一个ID记录到GEO类型集合中

[source, shell]
----
# 假如车辆ID是33，经纬度是 (116.034579 39.030452)
GEOADD cars:locations 116.034579 39.030452 33
----

* GEORADIUS: 根据输入的经纬度位置，查找以这个经纬度为中心的一定范围内的其它元素。（范围可自定义）

[source, shell]
----
#查找用户（116.054579 39.030452）5公里内的车辆信息, 最多10个
GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10
----