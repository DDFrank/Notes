== 基于TCP的半关闭

=== 单方面断开连接带来的问题

- Linux 的 `close` 和 Windows的 `closesocket`函数意味着完全断开连接。完全断开不仅指无法传输数据，而且也不能接收数据

- 为了解决完全断开的问题，"只关闭一部分数据交换中使用的流" (Half-clos)的方法就出现了。断开一部分连接是指，可以传输数据但无法接收，或可以接收数据但无法传输

=== 套接字和流 (Stream)

两台主机通过套接字建立连接后进入可交换数据的状态，又称"流形成的状态"。也就是把建立套接字后可交换数据的状态看作一种流。

每个主机都会拥有单独的输入流和输出流。

优雅断开，就是指只断开一个流，而不是 `close` 的断开两个流

=== 针对优雅断开的 shutdown 函数

[source, c]
----
#include <sys/socket.h>

int shutdown(int sock, int howto);
// 成功时返回0, 失败时返回 -1
----

第二个参数决定断开连接的方式

- SHUT_RD: 断开输入流

断开输入流后，套接字无法接收数据。即使输入缓冲收到数据也会抹去，而且无法调用输入相关函数


- SHUT_WR: 断开输出流

断开输出流，也就无法传输数据，但是如果输出缓冲中还留有未传输的数据，则将传递至目标主机

- SHUT_RDWR: 同时断开I/O流

相当于分2次调用 shutdown，其中一次以 SHUT_RD 为参数，另一次以 SHUT_WR 为参数


