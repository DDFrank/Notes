# Oauth2

## 基本步骤

- 用户打开客户端以后，客户端要求用户给与授权
- 用户同意给与客户端授权 (关键步骤)
- 客户端使用上一步获得的授权，向认证服务器申请令牌
- 认证服务器对客户端进行认证后，确认无误并发放令牌
- 客户端使用令牌，向资源服务器申请获取资源
- 资源服务器确认令牌无误，同意向客户端开发资源

## 客户端的授权模式

### 授权码模式

- 功能最完整，流程最严密。
- 通过客户端的后台服务器，与 "服务提供商"的认证服务器进行互动
- 流程如下
  - 用户访问客户端，后者将前者导向认证服务器
  - 用户选择是否给予客户端授权
  - 假设用户给予授权，认证服务器将用户导向客户端事先指定的 重定向URI,同时在URI上附上一个授权码
  - 客户端收到授权码，附上早先的 "重定向URI"， 向认证服务器申请令牌.这一步对用户是不可见的
  - 认证服务器核对了授权码和重定向URI，确认无误后，向客户端发送访问令牌 (access token) 和 更新令牌 (refresh token)。
- 上述各个步骤中都明确指定了参数, 相关消息采用 JSON 格式发送
- HTTP 信息中明确指定不得缓存。

### 简化模式

- 不通过第三方应用程序的服务器，直接在浏览器中向认证服务器申请令牌，跳过了 授权码这一个步骤
- 所有步骤都在客户端中完成，令牌对访问者是可见的，而且客户端不需要认证
  - 客户端将用户导向认证服务器
  - 用户决定是否给与客户端授权
  - 假设用户给与授权，认证服务器将用户导向客户端指定的 "重定向URI"， 并在 URI 的Hash部分包含了访问令牌
  - 浏览器向资源服务器发出请求，其中不包括上一步收到的Hash值
  - 资源服务器返回一个网页，其中包含的代码可以获取 Hash 值中的令牌
  - 浏览器执行上一步获得的脚本，提取出令牌
  - 浏览器将令牌发给客户端。

### 密码模式

- 用户向客户端提供自己的用户名和密码，客户端使用这些信息，向 "服务商提供商"索要授权
- 建立在用户对客户端高度信任的情况下

#### 客户端模式

- 客户端以自己的名义而不是用户的名义, 向"服务提供商"进行认证。



# JWT





# 灰度路由





